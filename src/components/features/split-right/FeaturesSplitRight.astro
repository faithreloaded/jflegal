---
import './FeaturesSplitRight.css';
import { type Locale, loadT } from '../../../i18n';

interface Props {
  lang: Locale;
}

const { lang } = Astro.props;
const t = await loadT(lang, ['features']);

// Fallback translations para features si el sistema no funciona
const featuresFallback = {
  es: {
    mercantil: {
      title: "Nuestra filosofía",
      subtitle: "Trabajamos desde la transparencia, el análisis y la confianza."
    }
  },
  en: {
    mercantil: {
      title: "Our philosophy",
      subtitle: "We work from transparency, analysis and trust."
    }
  },
  ca: {
    mercantil: {
      title: "La nostra filosofia",
      subtitle: "Treballam des de la transparència, l'anàlisi i la confiança."
    }
  }
};

// Función helper para obtener traducciones de features con fallback
function getFeaturesTranslation(key: string) {
  const translation = t(`features.${key}`);
  if (translation === `features.${key}`) {
    // Si no se encuentra la traducción, usar fallback
    const keys = key.split('.');
    let value = featuresFallback[lang];
    for (const k of keys) {
      value = value?.[k];
    }
    return value || key;
  }
  return translation;
}

const title = getFeaturesTranslation('mercantil.title');
const subtitle = getFeaturesTranslation('mercantil.subtitle');
---

<section class="features-split-section">
  <div class="container">
    <div class="features-split-grid">
      <!-- Left Column - Content -->
      <div class="features-split-content features-split-animate">
        <!-- First Container: Title + CTA -->
        <div class="features-split-header features-split-animate">
          <h2 class="features-split-title features-split-animate">{title}</h2>
          <div class="features-split-cta features-split-animate">
            <p>{subtitle}</p>
          </div>
        </div>

        <!-- Second Container: Content Items -->
        <div class="features-split-items-container features-split-animate">
          <div class="features-split-item features-split-animate">
            <p class="features-split-description features-split-animate">
              En JF Legal creemos en un ejercicio del derecho cercano, claro y honesto. Cada caso merece atención real, sin prisas ni automatismos. Trabajamos con criterio jurídico, empatía y transparencia, porque entendemos que detrás de cada trámite hay una persona y una historia que proteger.
            </p>
          </div>
        </div>
      </div>

      <!-- Right Column - Image -->
      <div class="features-split-image features-split-animate-sync">
        <div class="features-split-image-bg features-split-animate-sync"></div>
      </div>
    </div>
  </div>
</section>

<script>
  // Staggered animation for all elements
  document.addEventListener('DOMContentLoaded', function() {
    const animatedElements = document.querySelectorAll('.features-split-animate');
    const syncElements = document.querySelectorAll('.features-split-animate-sync');
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry, index) => {
        if (entry.isIntersecting) {
          setTimeout(() => {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }, index * 80);
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    });

    // Animate sync elements (image) with the title (index 1)
    const syncObserver = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          setTimeout(() => {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }, 80); // Same delay as title
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    });

    animatedElements.forEach(element => {
      observer.observe(element);
    });

    syncElements.forEach(element => {
      syncObserver.observe(element);
    });
  });
</script>
