---
import './FeaturesSplitLeft.css';
import { type Locale, loadT } from '../../../i18n';

interface Props {
  lang: Locale;
}

const { lang } = Astro.props;
const t = await loadT(lang, ['features']);

// Fallback translations para features si el sistema no funciona
const featuresFallback = {
  es: {
    sucesiones: {
      title: "Cómo trabajamos",
      description: "Escuchamos y comprendemos la situación desde el principio, analizamos y planificamos la mejor estrategia posible, y actuamos con rigor y seguimiento constante. Nuestro objetivo es que el cliente se sienta acompañado, informado y tranquilo en todo momento."
    }
  },
  en: {
    sucesiones: {
      title: "How we work",
      description: "We listen and understand the situation from the beginning, analyze and plan the best possible strategy, and act with rigor and constant follow-up. Our goal is for the client to feel accompanied, informed and calm at all times."
    }
  },
  ca: {
    sucesiones: {
      title: "Com treballem",
      description: "Escoltem i comprenem la situació des del principi, analitzem i planifiquem la millor estratègia possible, i actuem amb rigor i seguiment constant. El nostre objectiu és que el client se senti acompanyat, informat i tranquil en tot moment."
    }
  }
};

// Función helper para obtener traducciones de features con fallback
function getFeaturesTranslation(key: string) {
  const translation = t(`features.${key}`);
  if (translation === `features.${key}`) {
    // Si no se encuentra la traducción, usar fallback
    const keys = key.split('.');
    let value = featuresFallback[lang];
    for (const k of keys) {
      value = value?.[k];
    }
    return value || key;
  }
  return translation;
}

const title = getFeaturesTranslation('sucesiones.title');
const description = getFeaturesTranslation('sucesiones.description');
---

<section class="features-split-reverse-section">
  <div class="container">
    <div class="features-split-reverse-grid">
      <!-- Left Column - Image -->
      <div class="features-split-reverse-image features-split-reverse-animate">
        <div class="features-split-reverse-image-bg features-split-reverse-animate"></div>
      </div>

      <!-- Right Column - Content -->
      <div class="features-split-reverse-content features-split-reverse-animate">
        <h2 class="features-split-reverse-title features-split-reverse-animate">{title}</h2>
        <p class="features-split-reverse-description features-split-reverse-animate">
          {description}
        </p>
      </div>
    </div>
  </div>
</section>

<script>
  // Staggered animation for all elements
  document.addEventListener('DOMContentLoaded', function() {
    const animatedElements = document.querySelectorAll('.features-split-reverse-animate');
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry, index) => {
        if (entry.isIntersecting) {
          setTimeout(() => {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }, index * 150);
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    });

    animatedElements.forEach(element => {
      observer.observe(element);
    });
  });
</script>
