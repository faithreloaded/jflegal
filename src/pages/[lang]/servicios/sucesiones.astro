---
import '../../../styles/main.css';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import HeaderMega from '../../../components/header/header-mega/Header.astro';
import FooterGrid from '../../../components/footer/footer-grid/Footer.astro';
import PageBanner from '../../../components/hero/page-banner/PageBanner.astro';
import { LOCALES, type Locale, loadT } from '../../../i18n';

export async function getStaticPaths() {
  return (LOCALES as readonly string[]).map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params as { lang: Locale };
const t = await loadT(lang, ['header', 'footer', 'services']);

// Fallback translations para servicios si el sistema no funciona
const servicesFallback = {
  es: {
    sucesiones: {
      title: "Sucesiones",
      subtitle: "Planificación y tramitación de herencias y testamentos",
      description: "Planificación y tramitación de herencias y testamentos"
    }
  },
  en: {
    sucesiones: {
      title: "Successions",
      subtitle: "Inheritance and will planning and processing",
      description: "Inheritance and will planning and processing"
    }
  },
  ca: {
    sucesiones: {
      title: "Successions",
      subtitle: "Planificació i tramitació d'herències i testaments",
      description: "Planificació i tramitació d'herències i testaments"
    }
  }
};

// Función helper para obtener traducciones de servicios con fallback
function getServicesTranslation(key: string) {
  const translation = t(`services.${key}`);
  if (translation === `services.${key}`) {
    // Si no se encuentra la traducción, usar fallback
    const keys = key.split('.');
    let fallbackValue = servicesFallback[lang];
    for (const k of keys) {
      fallbackValue = fallbackValue?.[k];
    }
    return fallbackValue || key;
  }
  return translation;
}

const title = getServicesTranslation('sucesiones.title');
const subtitle = getServicesTranslation('sucesiones.subtitle');
const description = getServicesTranslation('sucesiones.description');
---

<BaseLayout 
  title={`${title} | JF Legal`} 
  description={subtitle}
>
  <HeaderMega lang={lang} />
  
  <main class="main">
    <!-- Page Hero -->
    <PageBanner 
      title={title} 
      subtitle={subtitle} 
    />
  </main>
  
  <FooterGrid lang={lang} />
</BaseLayout>

